{"version":3,"file":"index.umd.js","sources":["../node_modules/@swup/plugin/dist/index.modern.js","../node_modules/swup/node_modules/path-to-regexp/dist.es2015/index.js","../src/inc/env.ts","../src/inc/Logger.ts","../src/inc/functions.ts","../src/inc/ParsedRule.ts","../node_modules/swup/dist/Swup.modern.js","../src/inc/handlers.ts","../src/SwupFragmentPlugin.ts"],"sourcesContent":["function r(){return r=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t])}return r},r.apply(this,arguments)}const n=r=>String(r).split(\".\").map(r=>String(parseInt(r||\"0\",10))).concat([\"0\",\"0\"]).slice(0,3).join(\".\");class e{constructor(){this.isSwupPlugin=!0,this.swup=void 0,this.version=void 0,this.requires={},this.handlersToUnregister=[]}mount(){}unmount(){this.handlersToUnregister.forEach(r=>r()),this.handlersToUnregister=[]}_beforeMount(){if(!this.name)throw new Error(\"You must define a name of plugin when creating a class.\")}_afterUnmount(){}_checkRequirements(){return\"object\"!=typeof this.requires||Object.entries(this.requires).forEach(([r,e])=>{if(!function(r,e,t){const s=function(r,n){var e;if(\"swup\"===r)return null!=(e=n.version)?e:\"\";{var t;const e=n.findPlugin(r);return null!=(t=null==e?void 0:e.version)?t:\"\"}}(r,t);return!!s&&((r,e)=>e.every(e=>{const[,t,s]=e.match(/^([\\D]+)?(.*)$/)||[];var o,i;return((r,n)=>{const e={\"\":r=>0===r,\">\":r=>r>0,\">=\":r=>r>=0,\"<\":r=>r<0,\"<=\":r=>r<=0};return(e[n]||e[\"\"])(r)})((i=s,o=n(o=r),i=n(i),o.localeCompare(i,void 0,{numeric:!0})),t||\">=\")}))(s,e)}(r,e=Array.isArray(e)?e:[e],this.swup)){const n=`${r} ${e.join(\", \")}`;throw new Error(`Plugin version mismatch: ${this.name} requires ${n}`)}}),!0}on(r,n,e={}){var t;n=!(t=n).name.startsWith(\"bound \")||t.hasOwnProperty(\"prototype\")?n.bind(this):n;const s=this.swup.hooks.on(r,n,e);return this.handlersToUnregister.push(s),s}once(n,e,t={}){return this.on(n,e,r({},t,{once:!0}))}before(n,e,t={}){return this.on(n,e,r({},t,{before:!0}))}replace(n,e,t={}){return this.on(n,e,r({},t,{replace:!0}))}off(r,n){return this.swup.hooks.off(r,n)}}export{e as default};\n//# sourceMappingURL=index.modern.js.map\n","/**\n * Tokenize input string.\n */\nfunction lexer(str) {\n    var tokens = [];\n    var i = 0;\n    while (i < str.length) {\n        var char = str[i];\n        if (char === \"*\" || char === \"+\" || char === \"?\") {\n            tokens.push({ type: \"MODIFIER\", index: i, value: str[i++] });\n            continue;\n        }\n        if (char === \"\\\\\") {\n            tokens.push({ type: \"ESCAPED_CHAR\", index: i++, value: str[i++] });\n            continue;\n        }\n        if (char === \"{\") {\n            tokens.push({ type: \"OPEN\", index: i, value: str[i++] });\n            continue;\n        }\n        if (char === \"}\") {\n            tokens.push({ type: \"CLOSE\", index: i, value: str[i++] });\n            continue;\n        }\n        if (char === \":\") {\n            var name = \"\";\n            var j = i + 1;\n            while (j < str.length) {\n                var code = str.charCodeAt(j);\n                if (\n                // `0-9`\n                (code >= 48 && code <= 57) ||\n                    // `A-Z`\n                    (code >= 65 && code <= 90) ||\n                    // `a-z`\n                    (code >= 97 && code <= 122) ||\n                    // `_`\n                    code === 95) {\n                    name += str[j++];\n                    continue;\n                }\n                break;\n            }\n            if (!name)\n                throw new TypeError(\"Missing parameter name at \".concat(i));\n            tokens.push({ type: \"NAME\", index: i, value: name });\n            i = j;\n            continue;\n        }\n        if (char === \"(\") {\n            var count = 1;\n            var pattern = \"\";\n            var j = i + 1;\n            if (str[j] === \"?\") {\n                throw new TypeError(\"Pattern cannot start with \\\"?\\\" at \".concat(j));\n            }\n            while (j < str.length) {\n                if (str[j] === \"\\\\\") {\n                    pattern += str[j++] + str[j++];\n                    continue;\n                }\n                if (str[j] === \")\") {\n                    count--;\n                    if (count === 0) {\n                        j++;\n                        break;\n                    }\n                }\n                else if (str[j] === \"(\") {\n                    count++;\n                    if (str[j + 1] !== \"?\") {\n                        throw new TypeError(\"Capturing groups are not allowed at \".concat(j));\n                    }\n                }\n                pattern += str[j++];\n            }\n            if (count)\n                throw new TypeError(\"Unbalanced pattern at \".concat(i));\n            if (!pattern)\n                throw new TypeError(\"Missing pattern at \".concat(i));\n            tokens.push({ type: \"PATTERN\", index: i, value: pattern });\n            i = j;\n            continue;\n        }\n        tokens.push({ type: \"CHAR\", index: i, value: str[i++] });\n    }\n    tokens.push({ type: \"END\", index: i, value: \"\" });\n    return tokens;\n}\n/**\n * Parse a string for the raw tokens.\n */\nexport function parse(str, options) {\n    if (options === void 0) { options = {}; }\n    var tokens = lexer(str);\n    var _a = options.prefixes, prefixes = _a === void 0 ? \"./\" : _a, _b = options.delimiter, delimiter = _b === void 0 ? \"/#?\" : _b;\n    var result = [];\n    var key = 0;\n    var i = 0;\n    var path = \"\";\n    var tryConsume = function (type) {\n        if (i < tokens.length && tokens[i].type === type)\n            return tokens[i++].value;\n    };\n    var mustConsume = function (type) {\n        var value = tryConsume(type);\n        if (value !== undefined)\n            return value;\n        var _a = tokens[i], nextType = _a.type, index = _a.index;\n        throw new TypeError(\"Unexpected \".concat(nextType, \" at \").concat(index, \", expected \").concat(type));\n    };\n    var consumeText = function () {\n        var result = \"\";\n        var value;\n        while ((value = tryConsume(\"CHAR\") || tryConsume(\"ESCAPED_CHAR\"))) {\n            result += value;\n        }\n        return result;\n    };\n    var isSafe = function (value) {\n        for (var _i = 0, delimiter_1 = delimiter; _i < delimiter_1.length; _i++) {\n            var char = delimiter_1[_i];\n            if (value.indexOf(char) > -1)\n                return true;\n        }\n        return false;\n    };\n    var safePattern = function (prefix) {\n        var prev = result[result.length - 1];\n        var prevText = prefix || (prev && typeof prev === \"string\" ? prev : \"\");\n        if (prev && !prevText) {\n            throw new TypeError(\"Must have text between two parameters, missing text after \\\"\".concat(prev.name, \"\\\"\"));\n        }\n        if (!prevText || isSafe(prevText))\n            return \"[^\".concat(escapeString(delimiter), \"]+?\");\n        return \"(?:(?!\".concat(escapeString(prevText), \")[^\").concat(escapeString(delimiter), \"])+?\");\n    };\n    while (i < tokens.length) {\n        var char = tryConsume(\"CHAR\");\n        var name = tryConsume(\"NAME\");\n        var pattern = tryConsume(\"PATTERN\");\n        if (name || pattern) {\n            var prefix = char || \"\";\n            if (prefixes.indexOf(prefix) === -1) {\n                path += prefix;\n                prefix = \"\";\n            }\n            if (path) {\n                result.push(path);\n                path = \"\";\n            }\n            result.push({\n                name: name || key++,\n                prefix: prefix,\n                suffix: \"\",\n                pattern: pattern || safePattern(prefix),\n                modifier: tryConsume(\"MODIFIER\") || \"\",\n            });\n            continue;\n        }\n        var value = char || tryConsume(\"ESCAPED_CHAR\");\n        if (value) {\n            path += value;\n            continue;\n        }\n        if (path) {\n            result.push(path);\n            path = \"\";\n        }\n        var open = tryConsume(\"OPEN\");\n        if (open) {\n            var prefix = consumeText();\n            var name_1 = tryConsume(\"NAME\") || \"\";\n            var pattern_1 = tryConsume(\"PATTERN\") || \"\";\n            var suffix = consumeText();\n            mustConsume(\"CLOSE\");\n            result.push({\n                name: name_1 || (pattern_1 ? key++ : \"\"),\n                pattern: name_1 && !pattern_1 ? safePattern(prefix) : pattern_1,\n                prefix: prefix,\n                suffix: suffix,\n                modifier: tryConsume(\"MODIFIER\") || \"\",\n            });\n            continue;\n        }\n        mustConsume(\"END\");\n    }\n    return result;\n}\n/**\n * Compile a string to a template function for the path.\n */\nexport function compile(str, options) {\n    return tokensToFunction(parse(str, options), options);\n}\n/**\n * Expose a method for transforming tokens into the path function.\n */\nexport function tokensToFunction(tokens, options) {\n    if (options === void 0) { options = {}; }\n    var reFlags = flags(options);\n    var _a = options.encode, encode = _a === void 0 ? function (x) { return x; } : _a, _b = options.validate, validate = _b === void 0 ? true : _b;\n    // Compile all the tokens into regexps.\n    var matches = tokens.map(function (token) {\n        if (typeof token === \"object\") {\n            return new RegExp(\"^(?:\".concat(token.pattern, \")$\"), reFlags);\n        }\n    });\n    return function (data) {\n        var path = \"\";\n        for (var i = 0; i < tokens.length; i++) {\n            var token = tokens[i];\n            if (typeof token === \"string\") {\n                path += token;\n                continue;\n            }\n            var value = data ? data[token.name] : undefined;\n            var optional = token.modifier === \"?\" || token.modifier === \"*\";\n            var repeat = token.modifier === \"*\" || token.modifier === \"+\";\n            if (Array.isArray(value)) {\n                if (!repeat) {\n                    throw new TypeError(\"Expected \\\"\".concat(token.name, \"\\\" to not repeat, but got an array\"));\n                }\n                if (value.length === 0) {\n                    if (optional)\n                        continue;\n                    throw new TypeError(\"Expected \\\"\".concat(token.name, \"\\\" to not be empty\"));\n                }\n                for (var j = 0; j < value.length; j++) {\n                    var segment = encode(value[j], token);\n                    if (validate && !matches[i].test(segment)) {\n                        throw new TypeError(\"Expected all \\\"\".concat(token.name, \"\\\" to match \\\"\").concat(token.pattern, \"\\\", but got \\\"\").concat(segment, \"\\\"\"));\n                    }\n                    path += token.prefix + segment + token.suffix;\n                }\n                continue;\n            }\n            if (typeof value === \"string\" || typeof value === \"number\") {\n                var segment = encode(String(value), token);\n                if (validate && !matches[i].test(segment)) {\n                    throw new TypeError(\"Expected \\\"\".concat(token.name, \"\\\" to match \\\"\").concat(token.pattern, \"\\\", but got \\\"\").concat(segment, \"\\\"\"));\n                }\n                path += token.prefix + segment + token.suffix;\n                continue;\n            }\n            if (optional)\n                continue;\n            var typeOfMessage = repeat ? \"an array\" : \"a string\";\n            throw new TypeError(\"Expected \\\"\".concat(token.name, \"\\\" to be \").concat(typeOfMessage));\n        }\n        return path;\n    };\n}\n/**\n * Create path match function from `path-to-regexp` spec.\n */\nexport function match(str, options) {\n    var keys = [];\n    var re = pathToRegexp(str, keys, options);\n    return regexpToFunction(re, keys, options);\n}\n/**\n * Create a path match function from `path-to-regexp` output.\n */\nexport function regexpToFunction(re, keys, options) {\n    if (options === void 0) { options = {}; }\n    var _a = options.decode, decode = _a === void 0 ? function (x) { return x; } : _a;\n    return function (pathname) {\n        var m = re.exec(pathname);\n        if (!m)\n            return false;\n        var path = m[0], index = m.index;\n        var params = Object.create(null);\n        var _loop_1 = function (i) {\n            if (m[i] === undefined)\n                return \"continue\";\n            var key = keys[i - 1];\n            if (key.modifier === \"*\" || key.modifier === \"+\") {\n                params[key.name] = m[i].split(key.prefix + key.suffix).map(function (value) {\n                    return decode(value, key);\n                });\n            }\n            else {\n                params[key.name] = decode(m[i], key);\n            }\n        };\n        for (var i = 1; i < m.length; i++) {\n            _loop_1(i);\n        }\n        return { path: path, index: index, params: params };\n    };\n}\n/**\n * Escape a regular expression string.\n */\nfunction escapeString(str) {\n    return str.replace(/([.+*?=^!:${}()[\\]|/\\\\])/g, \"\\\\$1\");\n}\n/**\n * Get the flags for a regexp from the options.\n */\nfunction flags(options) {\n    return options && options.sensitive ? \"\" : \"i\";\n}\n/**\n * Pull out keys from a regexp.\n */\nfunction regexpToRegexp(path, keys) {\n    if (!keys)\n        return path;\n    var groupsRegex = /\\((?:\\?<(.*?)>)?(?!\\?)/g;\n    var index = 0;\n    var execResult = groupsRegex.exec(path.source);\n    while (execResult) {\n        keys.push({\n            // Use parenthesized substring match if available, index otherwise\n            name: execResult[1] || index++,\n            prefix: \"\",\n            suffix: \"\",\n            modifier: \"\",\n            pattern: \"\",\n        });\n        execResult = groupsRegex.exec(path.source);\n    }\n    return path;\n}\n/**\n * Transform an array into a regexp.\n */\nfunction arrayToRegexp(paths, keys, options) {\n    var parts = paths.map(function (path) { return pathToRegexp(path, keys, options).source; });\n    return new RegExp(\"(?:\".concat(parts.join(\"|\"), \")\"), flags(options));\n}\n/**\n * Create a path regexp from string input.\n */\nfunction stringToRegexp(path, keys, options) {\n    return tokensToRegexp(parse(path, options), keys, options);\n}\n/**\n * Expose a function for taking tokens and returning a RegExp.\n */\nexport function tokensToRegexp(tokens, keys, options) {\n    if (options === void 0) { options = {}; }\n    var _a = options.strict, strict = _a === void 0 ? false : _a, _b = options.start, start = _b === void 0 ? true : _b, _c = options.end, end = _c === void 0 ? true : _c, _d = options.encode, encode = _d === void 0 ? function (x) { return x; } : _d, _e = options.delimiter, delimiter = _e === void 0 ? \"/#?\" : _e, _f = options.endsWith, endsWith = _f === void 0 ? \"\" : _f;\n    var endsWithRe = \"[\".concat(escapeString(endsWith), \"]|$\");\n    var delimiterRe = \"[\".concat(escapeString(delimiter), \"]\");\n    var route = start ? \"^\" : \"\";\n    // Iterate over the tokens and create our regexp string.\n    for (var _i = 0, tokens_1 = tokens; _i < tokens_1.length; _i++) {\n        var token = tokens_1[_i];\n        if (typeof token === \"string\") {\n            route += escapeString(encode(token));\n        }\n        else {\n            var prefix = escapeString(encode(token.prefix));\n            var suffix = escapeString(encode(token.suffix));\n            if (token.pattern) {\n                if (keys)\n                    keys.push(token);\n                if (prefix || suffix) {\n                    if (token.modifier === \"+\" || token.modifier === \"*\") {\n                        var mod = token.modifier === \"*\" ? \"?\" : \"\";\n                        route += \"(?:\".concat(prefix, \"((?:\").concat(token.pattern, \")(?:\").concat(suffix).concat(prefix, \"(?:\").concat(token.pattern, \"))*)\").concat(suffix, \")\").concat(mod);\n                    }\n                    else {\n                        route += \"(?:\".concat(prefix, \"(\").concat(token.pattern, \")\").concat(suffix, \")\").concat(token.modifier);\n                    }\n                }\n                else {\n                    if (token.modifier === \"+\" || token.modifier === \"*\") {\n                        throw new TypeError(\"Can not repeat \\\"\".concat(token.name, \"\\\" without a prefix and suffix\"));\n                    }\n                    route += \"(\".concat(token.pattern, \")\").concat(token.modifier);\n                }\n            }\n            else {\n                route += \"(?:\".concat(prefix).concat(suffix, \")\").concat(token.modifier);\n            }\n        }\n    }\n    if (end) {\n        if (!strict)\n            route += \"\".concat(delimiterRe, \"?\");\n        route += !options.endsWith ? \"$\" : \"(?=\".concat(endsWithRe, \")\");\n    }\n    else {\n        var endToken = tokens[tokens.length - 1];\n        var isEndDelimited = typeof endToken === \"string\"\n            ? delimiterRe.indexOf(endToken[endToken.length - 1]) > -1\n            : endToken === undefined;\n        if (!strict) {\n            route += \"(?:\".concat(delimiterRe, \"(?=\").concat(endsWithRe, \"))?\");\n        }\n        if (!isEndDelimited) {\n            route += \"(?=\".concat(delimiterRe, \"|\").concat(endsWithRe, \")\");\n        }\n    }\n    return new RegExp(route, flags(options));\n}\n/**\n * Normalize the given path string, returning a regular expression.\n *\n * An empty array can be passed in for the keys, which will hold the\n * placeholder key descriptions. For example, using `/user/:id`, `keys` will\n * contain `[{ name: 'id', delimiter: '/', optional: false, repeat: false }]`.\n */\nexport function pathToRegexp(path, keys, options) {\n    if (path instanceof RegExp)\n        return regexpToRegexp(path, keys);\n    if (Array.isArray(path))\n        return arrayToRegexp(path, keys, options);\n    return stringToRegexp(path, keys, options);\n}\n//# sourceMappingURL=index.js.map","declare global {\n\tconst __DEV__: boolean;\n\tconst MICROBUNDLE_TARGET: string;\n\tinterface Window {\n\t\tprocess?: any;\n\t}\n}\n\n/**\n * Make sure process.env is defined in the browser\n */\nif (!window.process) window.process = {};\nif (!window.process.env) window.process.env = {};\n\n/**\n * Export the __DEV__ variable. This will become false in production builds from consumers\n */\nexport const __TEST__ = ['test'].includes(String(process.env.NODE_ENV));\nexport const __DEV__ = ['development', 'test'].includes(String(process.env.NODE_ENV));\n","import { __TEST__ } from './env.js';\n/**\n * Wrap a string in an escape sequence\n * @see https://stackoverflow.com/a/68373080/586823\n */\nconst wrapInEscapeSequence = (s: string, open: number, close: number): string => {\n\tif (s == null) return s;\n\treturn `\\x1b[${open}m${String(s)}\\x1b[${close}m`;\n};\n\n/**\n * Color Codes:\n * @see https://github.com/lzwme/console-log-colors/blob/56a41b352bf9ed327cc864f588b831d92ee6390e/src/index.js\n */\nconst bold = (s: string): string => wrapInEscapeSequence(s, 1, 22);\nconst purple = (s: string): string => wrapInEscapeSequence(s, 94, 39);\n\nconst prepare = (s: string): string => {\n\tif (__TEST__) return s;\n\treturn `🧩 ${bold(s)}`;\n};\n\nexport const highlight = (s: string): string => {\n\tif (__TEST__) return s;\n\treturn purple(s);\n};\n\n/**\n * A slim wrapper around console statements\n */\nexport default class Logger {\n\tlog(...args: any) {\n\t\tconst msg = args.shift();\n\t\tconsole.log(prepare(msg), ...args);\n\t}\n\twarn(...args: any) {\n\t\tconst msg = args.shift();\n\t\tconsole.warn(prepare(msg), ...args);\n\t}\n\terror(...args: any) {\n\t\tconst msg = args.shift();\n\t\tconsole.error(prepare(msg), ...args);\n\t}\n\tlogIf(condition: boolean, ...args: any) {\n\t\tif (condition) this.log(...args);\n\t}\n\twarnIf(condition: boolean, ...args: any) {\n\t\tif (condition) this.warn(...args);\n\t}\n\terrorIf(condition: boolean, ...args: any) {\n\t\tif (condition) this.error(...args);\n\t}\n}\n","import Swup, { Location } from 'swup';\nimport type { Visit, VisitScroll } from 'swup';\nimport type { default as FragmentPlugin } from '../SwupFragmentPlugin.js';\nimport type { Route, Rule, FragmentVisit, FragmentElement } from './defs.js';\nimport type ParsedRule from './ParsedRule.js';\nimport Logger, { highlight } from './Logger.js';\n\nimport { __DEV__ } from './env.js';\n\n/**\n * Handles a page view. Runs on `mount` as well as on every content:replace\n */\nexport const handlePageView = (fragmentPlugin: FragmentPlugin): void => {\n\tprepareFragmentElements(fragmentPlugin);\n\thandleLinksToFragments(fragmentPlugin);\n\tshowDialogs(fragmentPlugin);\n};\n\n/**\n * Run `showModal` for all `<dialog[data-swup-fragment][open]>` elements\n * This puts them on the top layer and makes them ignore css transforms on parent elements\n * @see https://developer.mozilla.org/en-US/docs/Glossary/Top_layer\n */\nfunction showDialogs({ logger }: FragmentPlugin): void {\n\tdocument\n\t\t.querySelectorAll<HTMLDialogElement & FragmentElement>('dialog[data-swup-fragment][open]')\n\t\t.forEach((el) => {\n\t\t\tif (!el.__swupFragment) {\n\t\t\t\tif (__DEV__) logger?.warn(`fragment properties missing on element:`, el);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (el.__swupFragment.modalShown) return;\n\t\t\tel.__swupFragment.modalShown = true;\n\t\t\tel.removeAttribute('open');\n\t\t\t/** don't assume showModal exists – otherwise unit tests will fail */\n\t\t\tel.showModal?.();\n\t\t\tel.addEventListener('keydown', (e) => e.key === 'Escape' && e.preventDefault());\n\t\t});\n}\n\n/**\n * Updates the `href` of links matching [data-swup-link-to-fragment=\"#my-fragment\"]\n */\nfunction handleLinksToFragments({ logger, swup }: FragmentPlugin): void {\n\tconst targetAttribute = 'data-swup-link-to-fragment';\n\tconst links = document.querySelectorAll<HTMLAnchorElement>(`a[${targetAttribute}]`);\n\n\tlinks.forEach((el) => {\n\t\tconst selector = el.getAttribute(targetAttribute);\n\t\tif (!selector) {\n\t\t\t// prettier-ignore\n\t\t\tif (__DEV__) logger?.warn(`[${targetAttribute}] needs to contain a valid fragment selector`);\n\t\t\treturn;\n\t\t}\n\n\t\tconst fragment = queryFragmentElement(selector, swup);\n\t\tif (!fragment) {\n\t\t\tif (__DEV__) {\n\t\t\t\tlogger?.log(\n\t\t\t\t\t// prettier-ignore\n\t\t\t\t\t`ignoring ${highlight(`[${targetAttribute}=\"${selector}\"]`)} as ${highlight(selector)} is missing`\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tconst fragmentUrl = fragment.__swupFragment?.url;\n\t\tif (!fragmentUrl) {\n\t\t\tif (__DEV__) logger?.warn(`no fragment infos found on ${selector}`);\n\t\t\treturn;\n\t\t}\n\n\t\t// Help finding suspicious fragment urls\n\t\tif (isEqualUrl(fragmentUrl, swup.getCurrentUrl())) {\n\t\t\t// prettier-ignore\n\t\t\tif (__DEV__) logger?.warn(`The fragment URL of ${selector} is identical to the current URL. This could mean that [data-swup-fragment-url] needs to be provided by the server.`);\n\t\t}\n\n\t\tel.href = fragmentUrl;\n\t});\n}\n\n/**\n * Adds attributes and properties to fragment elements\n */\nfunction prepareFragmentElements({ parsedRules, swup, logger }: FragmentPlugin): void {\n\tconst currentUrl = swup.getCurrentUrl();\n\n\tparsedRules\n\t\t.filter((rule) => rule.matchesFrom(currentUrl) || rule.matchesTo(currentUrl))\n\t\t.forEach((rule) => {\n\t\t\trule.containers.forEach((selector) => {\n\t\t\t\tconst el = queryFragmentElement(`${selector}:not([data-swup-fragment])`, swup);\n\n\t\t\t\t// No element\n\t\t\t\tif (!el) return;\n\n\t\t\t\t// Parse a provided fragment URL\n\t\t\t\tconst providedFragmentUrl = el.getAttribute('data-swup-fragment-url');\n\t\t\t\tif (providedFragmentUrl) {\n\t\t\t\t\tif (__DEV__) {\n\t\t\t\t\t\t// prettier-ignore\n\t\t\t\t\t\tlogger?.log(`fragment url ${highlight(providedFragmentUrl)} for ${highlight(selector)} provided by server`);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Get the fragment URL\n\t\t\t\tconst { url } = Location.fromUrl(providedFragmentUrl || currentUrl);\n\n\t\t\t\t// Mark the element as a fragment\n\t\t\t\tel.setAttribute('data-swup-fragment', '');\n\n\t\t\t\t// Augment the element with the necessary properties\n\t\t\t\tel.__swupFragment = { url, selector };\n\t\t\t});\n\t\t});\n}\n\n/**\n * Get all containers that should be replaced for a given visit's route.\n * Ignores containers that already match the current URL, if the visit can't be considered a reload.\n *\n * A visit is being considered a reload, if one of these conditions apply:\n * \t- `route.from` equal to `route.to`\n *  - all containers match the current url and swup is set to navigate on `linkToSelf`\n */\nexport const getFragmentVisitContainers = (\n\troute: Route,\n\tselectors: string[],\n\tswup: Swup,\n\tlogger?: Logger\n): string[] => {\n\tlet fragments: { selector: string; el: FragmentElement }[] = selectors\n\t\t.map((selector) => {\n\t\t\tconst el = document.querySelector<FragmentElement>(selector);\n\n\t\t\tif (!el) {\n\t\t\t\tif (__DEV__) logger?.log(`${highlight(selector)} missing in current document`);\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst fragmentElement = queryFragmentElement(selector, swup);\n\n\t\t\tif (!fragmentElement) {\n\t\t\t\tif (__DEV__) {\n\t\t\t\t\t// prettier-ignore\n\t\t\t\t\tlogger?.error(`${highlight(selector)} is outside of swup's default containers`);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tselector,\n\t\t\t\tel\n\t\t\t};\n\t\t})\n\t\t.filter((record): record is { selector: string; el: FragmentElement } => !!record);\n\n\tconst isLinkToSelf = fragments.every((fragment) =>\n\t\telementMatchesFragmentUrl(fragment.el, route.to)\n\t);\n\n\tconst isReload =\n\t\tisEqualUrl(route.from, route.to) ||\n\t\t(isLinkToSelf && swup.options.linkToSelf === 'navigate');\n\n\t/**\n\t * If this is NOT a reload, ignore fragments that already match `route.to`\n\t */\n\tif (!isReload) {\n\t\tfragments = fragments.filter((fragment) => {\n\t\t\tif (elementMatchesFragmentUrl(fragment.el, route.to)) {\n\t\t\t\tif (__DEV__) {\n\t\t\t\t\t// prettier-ignore\n\t\t\t\t\tlogger?.log(`ignoring fragment ${highlight(fragment.selector)} as it already matches the current URL`);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t});\n\t}\n\n\treturn fragments.map((fragment) => fragment.selector);\n};\n\n/**\n * Checks if an element's fragment url matches a given URL\n */\nexport const elementMatchesFragmentUrl = (el: FragmentElement, url: string): boolean => {\n\tconst fragmentUrl = el.__swupFragment?.url;\n\tif (!fragmentUrl) return false;\n\treturn isEqualUrl(fragmentUrl, url);\n};\n\n/**\n * Checks if two URLs should be considered equal:\n *\n * - ignores trailing slashes\n * - ignores query string order\n *\n * Example: /test?foo=bar&baz=boo === /test/?baz=boo&foo=bar\n */\nconst isEqualUrl = (url1: string, url2: string) => {\n\treturn normalizeUrl(url1) === normalizeUrl(url2);\n};\n\n/**\n * Normalize a URL\n *\n * - removes the trailing slash\n * - sorts query params\n */\nexport const normalizeUrl = (url: string) => {\n\tif (!url.trim()) return url;\n\n\tconst removeTrailingSlash = (str: string) => str.replace(/\\/+$/g, '');\n\n\tconst location = Location.fromUrl(url);\n\tlocation.searchParams.sort();\n\n\treturn removeTrailingSlash(location.pathname) + location.search;\n};\n\n/**\n * Removes all fragment traces from all fragment elements\n */\nexport const cleanupFragmentElements = () => {\n\tdocument.querySelectorAll<FragmentElement>('[data-swup-fragment]').forEach((el) => {\n\t\tel.removeAttribute('data-swup-fragment-url');\n\t\tdelete el.__swupFragment;\n\t});\n};\n\n/**\n * Get the route from a given visit\n */\nexport const getRoute = (visit: Visit): Route | undefined => {\n\tconst from = visit.from.url;\n\tconst to = visit.to.url;\n\tif (!from || !to) return;\n\treturn { from, to };\n};\n\n/**\n * Adds or removes a rule's name class from all current fragment elements\n */\nexport const toggleFragmentVisitClass = (\n\tfragmentVisit: FragmentVisit | undefined,\n\ttoggle: boolean\n): void => {\n\tif (!fragmentVisit?.name) return;\n\n\tconst { name, containers } = fragmentVisit;\n\n\tcontainers.forEach((selector) => {\n\t\tdocument.querySelector(selector)?.classList.toggle(`to-${name}`, toggle);\n\t});\n};\n\n/**\n * Get the first matching rule for a given route\n */\nexport const getFirstMatchingRule = (\n\troute: Route,\n\trules: ParsedRule[],\n\tvisit: Visit\n): ParsedRule | undefined => {\n\treturn rules.find((rule) => rule.matches(route, visit));\n};\n\n/**\n * Makes sure unchanged fragment elements land in the cache of the current page\n */\nexport const cacheForeignFragmentElements = ({ swup, logger }: FragmentPlugin): void => {\n\tconst currentUrl = swup.getCurrentUrl();\n\tconst cache = swup.cache;\n\n\t// Get the cache entry for the current URL\n\tconst currentCache = cache.get(currentUrl);\n\tif (!currentCache) return;\n\tconst currentCachedDocument = new DOMParser().parseFromString(currentCache.html, 'text/html');\n\n\t// debug info\n\tconst updatedFragments: FragmentElement[] = [];\n\n\t/**\n\t * We only want to handle fragment elements that\n\t *  - are not templates\n\t *  - don't fit the current URL\n\t */\n\tconst foreignFragmentElements = Array.from(\n\t\tdocument.querySelectorAll<FragmentElement>('[data-swup-fragment]')\n\t).filter((el) => {\n\t\tif (el.matches('template')) return false;\n\t\tif (elementMatchesFragmentUrl(el, currentUrl)) return false;\n\t\treturn true;\n\t});\n\n\t// Bail early if there are no foreign fragment elements\n\tif (!foreignFragmentElements.length) return;\n\n\tif (!swup.options.cache) {\n\t\tif (__DEV__) logger?.warn(`can't cache foreign fragment elements without swup's cache`);\n\t\treturn;\n\t}\n\n\tforeignFragmentElements.forEach((el) => {\n\t\t// Don't cache the fragment if it contains fragment elements\n\t\tconst containsFragments = el.querySelector('[data-swup-fragment]') != null;\n\t\tif (containsFragments) return;\n\n\t\tconst fragmentUrl = el.__swupFragment?.url;\n\t\tif (!fragmentUrl) {\n\t\t\tif (__DEV__) logger?.warn(`no fragment url found:`, el);\n\t\t\treturn;\n\t\t}\n\n\t\tconst fragmentSelector = el.__swupFragment?.selector;\n\t\tif (!fragmentSelector) {\n\t\t\tif (__DEV__) logger?.warn(`no fragment selector found:`, el);\n\t\t\treturn;\n\t\t}\n\n\t\t// Get the cache entry for the fragment URL, bail early if it doesn't exist\n\t\tconst fragmentCache = cache.get(fragmentUrl);\n\t\tif (!fragmentCache) return;\n\n\t\t// Check if the fragment exists in the current cached document\n\t\tconst currentFragment = currentCachedDocument.querySelector(fragmentSelector);\n\t\tif (!currentFragment) return;\n\n\t\t// Get a fresh copy of the fragment from it's original cache\n\t\tconst unchangedFragment = new DOMParser()\n\t\t\t.parseFromString(fragmentCache.html, 'text/html')\n\t\t\t.querySelector(fragmentSelector);\n\t\tif (!unchangedFragment) return;\n\n\t\t// Make sure the dynamic fragment url makes it to the cache\n\t\tunchangedFragment.setAttribute('data-swup-fragment-url', fragmentUrl);\n\n\t\t// Replace the current fragment with the unchanged fragment\n\t\tcurrentFragment.replaceWith(unchangedFragment);\n\n\t\t// For debugging\n\t\tupdatedFragments.push(el);\n\t});\n\n\tif (!updatedFragments.length) return;\n\n\t// Update the cache of the current page with the updated html\n\tcache.update(currentUrl, {\n\t\tfragmentHtml: currentCachedDocument.documentElement.outerHTML\n\t});\n\n\tupdatedFragments.forEach((el) => {\n\t\tconst url = el.__swupFragment?.url || '';\n\t\tconst selector = el.__swupFragment?.selector || '';\n\t\t// prettier-ignore\n\t\tif (__DEV__) logger?.log(`updated cache with ${highlight(selector)} from ${highlight(url)}`);\n\t});\n};\n\n/**\n * Skips the animation if all current containers are <template> elements\n */\nexport function shouldSkipAnimation(fragmentVisit?: FragmentVisit): boolean {\n\tif (!fragmentVisit) return false;\n\n\treturn fragmentVisit.containers.every((selector) => {\n\t\treturn (\n\t\t\tdocument.querySelector<FragmentElement>(selector)?.tagName?.toLowerCase() === 'template'\n\t\t);\n\t});\n}\n\n/**\n * Remove duplicates from an array\n */\nexport function dedupe<T>(arr: Array<T>): Array<T> {\n\treturn [...new Set<T>(arr)];\n}\n\n/**\n * Adjusts visit.scroll based on given fragment visit\n */\nexport function adjustVisitScroll(fragmentVisit: FragmentVisit, scroll: VisitScroll): VisitScroll {\n\tif (typeof fragmentVisit.scroll === 'boolean') {\n\t\treturn { ...scroll, reset: fragmentVisit.scroll };\n\t}\n\tif (typeof fragmentVisit.scroll === 'string' && !scroll.target) {\n\t\treturn { ...scroll, target: fragmentVisit.scroll };\n\t}\n\treturn scroll;\n}\n\n/**\n * Queries a fragment element. Needs to be either:\n *\n * - one of swup's default containers\n * - inside of one of swup's default containers\n */\nexport function queryFragmentElement(\n\tfragmentSelector: string,\n\tswup: Swup\n): FragmentElement | undefined {\n\tfor (const containerSelector of swup.options.containers) {\n\t\tconst container = document.querySelector(containerSelector);\n\t\tif (container?.matches(fragmentSelector)) return container as FragmentElement;\n\n\t\tconst fragment = container?.querySelector<FragmentElement>(fragmentSelector);\n\t\tif (fragment) return fragment;\n\t}\n\treturn;\n}\n\n/**\n * Clone fragment rules (replacement for `structuredClone`)\n */\nexport function cloneRules(rules: Rule[]): Rule[] {\n\tif (!Array.isArray(rules)) throw new Error(`cloneRules() expects an array of rules`);\n\n\treturn rules.map((rule) => ({\n\t\t...rule,\n\t\tfrom: Array.isArray(rule.from) ? [...rule.from] : rule.from,\n\t\tto: Array.isArray(rule.to) ? [...rule.to] : rule.to,\n\t\tcontainers: [...rule.containers]\n\t}));\n}\n\n/**\n * Create a visit object for tests\n */\nexport function stubVisit(options: { from?: string; to: string }) {\n\tconst swup = new Swup();\n\t// @ts-expect-error swup.createVisit is protected\n\treturn swup.createVisit(options);\n}\n","import { matchPath, classify, Location } from 'swup';\nimport type { Swup, Path, Visit } from 'swup';\nimport type { Route, Rule, Predicate } from './defs.js';\nimport { dedupe, queryFragmentElement } from './functions.js';\nimport Logger, { highlight } from './Logger.js';\nimport { __DEV__ } from './env.js';\n\ntype Options = Rule & {\n\tswup: Swup;\n\tlogger?: Logger;\n};\n\n/**\n * Represents a Rule\n */\nexport default class ParsedRule {\n\treadonly matchesFrom: ReturnType<typeof matchPath>;\n\treadonly matchesTo: ReturnType<typeof matchPath>;\n\n\tswup: Swup;\n\tfrom: Path;\n\tto: Path;\n\tcontainers: string[];\n\tname?: string;\n\tscroll: boolean | string = false;\n\tfocus?: boolean | string;\n\tlogger?: Logger;\n\tif: Predicate = () => true;\n\n\tconstructor(options: Options) {\n\t\tthis.swup = options.swup;\n\t\tthis.logger = options.logger;\n\t\tthis.from = options.from || '';\n\t\tthis.to = options.to || '';\n\n\t\tif (options.name) this.name = classify(options.name);\n\t\tif (typeof options.scroll !== 'undefined') this.scroll = options.scroll;\n\t\tif (typeof options.focus !== 'undefined') this.focus = options.focus;\n\t\tif (typeof options.if === 'function') this.if = options.if;\n\n\t\tthis.containers = this.parseContainers(options.containers);\n\n\t\tif (__DEV__) {\n\t\t\tthis.logger?.errorIf(!this.to, `Every fragment rule must contain a 'to' path`, this);\n\t\t\tthis.logger?.errorIf(!this.from, `Every fragment rule must contain a 'from' path`, this); // prettier-ignore\n\t\t}\n\n\t\tthis.matchesFrom = matchPath(this.from);\n\t\tthis.matchesTo = matchPath(this.to);\n\t}\n\n\t/**\n\t * Parse provided fragment containers\n\t */\n\tparseContainers(rawContainers: string[]): string[] {\n\t\tif (!Array.isArray(rawContainers) || !rawContainers.length) {\n\t\t\t// prettier-ignore\n\t\t\tif (__DEV__) this.logger?.error(`Every fragment rule must contain an array of containers`, this.getDebugInfo());\n\t\t\treturn [];\n\t\t}\n\t\t// trim selectors\n\t\tconst containers = dedupe(rawContainers.map((selector) => selector.trim()));\n\t\treturn containers.filter((selector) => {\n\t\t\tconst result = this.validateSelector(selector);\n\t\t\tthis.logger?.errorIf(result instanceof Error, result);\n\t\t\treturn result === true;\n\t\t});\n\t}\n\n\t/**\n\t * Validate a fragment selector\n\t *\n\t * - only IDs are allowed\n\t * - no nested selectors\n\t */\n\tvalidateSelector(selector: string): true | Error {\n\t\tif (!selector.startsWith('#')) {\n\t\t\treturn new Error(`fragment selectors must be IDs: ${selector}`);\n\t\t}\n\n\t\tif (selector.match(/\\s|>/)) {\n\t\t\treturn new Error(`fragment selectors must not be nested: ${selector}`);\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * Get debug info for logging\n\t */\n\tgetDebugInfo() {\n\t\tconst { from, to, containers } = this;\n\t\treturn {\n\t\t\tfrom: String(from),\n\t\t\tto: String(to),\n\t\t\tcontainers: String(containers)\n\t\t};\n\t}\n\n\t/**\n\t * Checks if a given route matches this rule\n\t */\n\tpublic matches(route: Route, visit: Visit): boolean {\n\t\tif (!this.if(visit)) {\n\t\t\tif (__DEV__) {\n\t\t\t\tthis.logger?.log(`ignoring fragment rule due to custom rule.if:`, this);\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tconst { url: fromUrl } = Location.fromUrl(route.from);\n\t\tconst { url: toUrl } = Location.fromUrl(route.to);\n\n\t\tconst matchesRoute = !!this.matchesFrom(fromUrl) && !!this.matchesTo(toUrl);\n\t\tif (!matchesRoute) return false;\n\n\t\tfor (const selector of this.containers) {\n\t\t\tconst result = this.validateFragmentSelectorForMatch(selector);\n\t\t\tif (result instanceof Error) {\n\t\t\t\tif (__DEV__) this.logger?.error(result, this.getDebugInfo());\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Validates a fragment element at runtime when this rule's route matches\n\t */\n\tvalidateFragmentSelectorForMatch(selector: string): true | Error {\n\t\tif (!document.querySelector(selector)) {\n\t\t\t// prettier-ignore\n\t\t\treturn new Error(`skipping rule since ${highlight(selector)} doesn't exist in the current document`);\n\t\t}\n\t\tif (!queryFragmentElement(selector, this.swup)) {\n\t\t\t// prettier-ignore\n\t\t\treturn new Error(`skipping rule since ${highlight(selector)} is outside of swup's default containers`);\n\t\t}\n\t\treturn true;\n\t}\n}\n","import t from\"delegate-it\";import{match as e}from\"path-to-regexp\";function i(){return i=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)({}).hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},i.apply(null,arguments)}const s=(t,e)=>String(t).toLowerCase().replace(/[\\s/_.]+/g,\"-\").replace(/[^\\w-]+/g,\"\").replace(/--+/g,\"-\").replace(/^-+|-+$/g,\"\")||e||\"\",n=({hash:t}={})=>window.location.pathname+window.location.search+(t?window.location.hash:\"\"),o=(t,e={})=>{const s=i({url:t=t||n({hash:!0}),random:Math.random(),source:\"swup\"},e);window.history.pushState(s,\"\",t)},r=(t=null,e={})=>{t=t||n({hash:!0});const s=i({},window.history.state||{},{url:t,random:Math.random(),source:\"swup\"},e);window.history.replaceState(s,\"\",t)},a=(e,s,n,o)=>{const r=new AbortController;return o=i({},o,{signal:r.signal}),t(e,s,n,o),{destroy:()=>r.abort()}};class l extends URL{constructor(t,e=document.baseURI){super(t.toString(),e),Object.setPrototypeOf(this,l.prototype)}get url(){return this.pathname+this.search}static fromElement(t){const e=t.getAttribute(\"href\")||t.getAttribute(\"xlink:href\")||\"\";return new l(e)}static fromUrl(t){return new l(t)}}const h=(t,i)=>{Array.isArray(t)&&!t.length&&(t=\"\");try{return e(t,i)}catch(e){throw new Error(`[swup] Error parsing path \"${String(t)}\":\\n${String(e)}`)}};class c extends Error{constructor(t,e){super(t),this.url=void 0,this.status=void 0,this.aborted=void 0,this.timedOut=void 0,this.name=\"FetchError\",this.url=e.url,this.status=e.status,this.aborted=e.aborted||!1,this.timedOut=e.timedOut||!1}}async function u(t,e={}){var s;t=l.fromUrl(t).url;const{visit:n=this.visit}=e,o=i({},this.options.requestHeaders,e.headers),r=null!=(s=e.timeout)?s:this.options.timeout,a=new AbortController,{signal:h}=a;e=i({},e,{headers:o,signal:h});let u,d=!1,p=null;r&&r>0&&(p=setTimeout(()=>{d=!0,a.abort(\"timeout\")},r));try{u=await this.hooks.call(\"fetch:request\",n,{url:t,options:e},(t,{url:e,options:i})=>fetch(e,i)),p&&clearTimeout(p)}catch(e){if(d)throw this.hooks.call(\"fetch:timeout\",n,{url:t}),new c(`Request timed out: ${t}`,{url:t,timedOut:d});if(\"AbortError\"===(null==e?void 0:e.name)||h.aborted)throw new c(`Request aborted: ${t}`,{url:t,aborted:!0});throw e}const{status:m,url:w}=u,f=await u.text();if(500===m)throw this.hooks.call(\"fetch:error\",n,{status:m,response:u,url:w}),new c(`Server error: ${w}`,{status:m,url:w});if(!f)throw new c(`Empty response: ${w}`,{status:m,url:w});const{url:g}=l.fromUrl(w),v={url:g,html:f};return!n.cache.write||e.method&&\"GET\"!==e.method||t!==g||this.cache.set(v.url,v),v}class d{constructor(t){this.swup=void 0,this.pages=new Map,this.swup=t}get size(){return this.pages.size}get all(){const t=new Map;return this.pages.forEach((e,s)=>{t.set(s,i({},e))}),t}has(t){return this.pages.has(this.resolve(t))}get(t){const e=this.pages.get(this.resolve(t));return e?i({},e):e}set(t,e){e=i({},e,{url:t=this.resolve(t)}),this.pages.set(t,e),this.swup.hooks.callSync(\"cache:set\",void 0,{page:e})}update(t,e){t=this.resolve(t);const s=i({},this.get(t),e,{url:t});this.pages.set(t,s)}delete(t){this.pages.delete(this.resolve(t))}clear(){this.pages.clear(),this.swup.hooks.callSync(\"cache:clear\",void 0,void 0)}prune(t){this.pages.forEach((e,i)=>{t(i,e)&&this.delete(i)})}resolve(t){const{url:e}=l.fromUrl(t);return this.swup.resolveUrl(e)}}const p=(t,e=document)=>e.querySelector(t),m=(t,e=document)=>Array.from(e.querySelectorAll(t)),w=()=>new Promise(t=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{t()})})});function f(t){return!!t&&(\"object\"==typeof t||\"function\"==typeof t)&&\"function\"==typeof t.then}function g(t,e=[]){return new Promise((i,s)=>{const n=t(...e);f(n)?n.then(i,s):i(n)})}function v(t){var e;null==(e=t=t||document.body)||e.getBoundingClientRect()}function y(t,e){const i=null==t?void 0:t.closest(`[${e}]`);return null!=i&&i.hasAttribute(e)?(null==i?void 0:i.getAttribute(e))||!0:void 0}class k{constructor(t){this.swup=void 0,this.swupClasses=[\"to-\",\"is-changing\",\"is-rendering\",\"is-popstate\",\"is-animating\",\"is-leaving\"],this.swup=t}get selectors(){const{scope:t}=this.swup.visit.animation;return\"containers\"===t?this.swup.visit.containers:\"html\"===t?[\"html\"]:Array.isArray(t)?t:[]}get selector(){return this.selectors.join(\",\")}get targets(){return this.selector.trim()?m(this.selector):[]}add(...t){this.targets.forEach(e=>e.classList.add(...t))}remove(...t){this.targets.forEach(e=>e.classList.remove(...t))}clear(){this.targets.forEach(t=>{const e=t.className.split(\" \").filter(t=>this.isSwupClass(t));t.classList.remove(...e)})}isSwupClass(t){return this.swupClasses.some(e=>t.startsWith(e))}}class b{constructor(t,e){this.id=void 0,this.state=void 0,this.from=void 0,this.to=void 0,this.containers=void 0,this.animation=void 0,this.trigger=void 0,this.cache=void 0,this.history=void 0,this.scroll=void 0,this.meta=void 0;const{to:i,from:s,hash:n,el:o,event:r}=e;this.id=Math.random(),this.state=1,this.from={url:null!=s?s:t.location.url,hash:t.location.hash},this.to={url:i,hash:n},this.containers=t.options.containers,this.animation={animate:!0,wait:!1,name:void 0,native:t.options.native,scope:t.options.animationScope,selector:t.options.animationSelector},this.trigger={el:o,event:r},this.cache={read:t.options.cache,write:t.options.cache},this.history={action:\"push\",popstate:!1,direction:void 0},this.scroll={reset:!0,target:void 0},this.meta={}}advance(t){this.state<t&&(this.state=t)}abort(){this.state=8}get done(){return this.state>=7}}function S(t){return new b(this,t)}class E{constructor(t){this.swup=void 0,this.registry=new Map,this.hooks=[\"animation:out:start\",\"animation:out:await\",\"animation:out:end\",\"animation:in:start\",\"animation:in:await\",\"animation:in:end\",\"animation:skip\",\"cache:clear\",\"cache:set\",\"content:replace\",\"content:scroll\",\"enable\",\"disable\",\"fetch:request\",\"fetch:error\",\"fetch:timeout\",\"history:popstate\",\"link:click\",\"link:self\",\"link:anchor\",\"link:newtab\",\"page:load\",\"page:view\",\"scroll:top\",\"scroll:anchor\",\"visit:start\",\"visit:transition\",\"visit:abort\",\"visit:end\"],this.swup=t,this.init()}init(){this.hooks.forEach(t=>this.create(t))}create(t){this.registry.has(t)||this.registry.set(t,new Map)}exists(t){return this.registry.has(t)}get(t){const e=this.registry.get(t);if(e)return e;console.error(`Unknown hook '${t}'`)}clear(){this.registry.forEach(t=>t.clear())}on(t,e,s={}){const n=this.get(t);if(!n)return console.warn(`Hook '${t}' not found.`),()=>{};const o=i({},s,{id:n.size+1,hook:t,handler:e});return n.set(e,o),()=>this.off(t,e)}before(t,e,s={}){return this.on(t,e,i({},s,{before:!0}))}replace(t,e,s={}){return this.on(t,e,i({},s,{replace:!0}))}once(t,e,s={}){return this.on(t,e,i({},s,{once:!0}))}off(t,e){const i=this.get(t);i&&e?i.delete(e)||console.warn(`Handler for hook '${t}' not found.`):i&&i.clear()}async call(t,e,i,s){const[n,o,r]=this.parseCallArgs(t,e,i,s),{before:a,handler:l,after:h}=this.getHandlers(t,r);await this.run(a,n,o);const[c]=await this.run(l,n,o,!0);return await this.run(h,n,o),this.dispatchDomEvent(t,n,o),c}callSync(t,e,i,s){const[n,o,r]=this.parseCallArgs(t,e,i,s),{before:a,handler:l,after:h}=this.getHandlers(t,r);this.runSync(a,n,o);const[c]=this.runSync(l,n,o,!0);return this.runSync(h,n,o),this.dispatchDomEvent(t,n,o),c}parseCallArgs(t,e,i,s){return e instanceof b||\"object\"!=typeof e&&\"function\"!=typeof i?[e,i,s]:[void 0,e,i]}async run(t,e=this.swup.visit,i,s=!1){const n=[];for(const{hook:o,handler:r,defaultHandler:a,once:l}of t)if(null==e||!e.done){l&&this.off(o,r);try{const t=await g(r,[e,i,a]);n.push(t)}catch(t){if(s)throw t;console.error(`Error in hook '${o}':`,t)}}return n}runSync(t,e=this.swup.visit,i,s=!1){const n=[];for(const{hook:o,handler:r,defaultHandler:a,once:l}of t)if(null==e||!e.done){l&&this.off(o,r);try{const t=r(e,i,a);n.push(t),f(t)&&console.warn(`Swup will not await Promises in handler for synchronous hook '${o}'.`)}catch(t){if(s)throw t;console.error(`Error in hook '${o}':`,t)}}return n}getHandlers(t,e){const i=this.get(t);if(!i)return{found:!1,before:[],handler:[],after:[],replaced:!1};const s=Array.from(i.values()),n=this.sortRegistrations,o=s.filter(({before:t,replace:e})=>t&&!e).sort(n),r=s.filter(({replace:t})=>t).filter(t=>!0).sort(n),a=s.filter(({before:t,replace:e})=>!t&&!e).sort(n),l=r.length>0;let h=[];if(e&&(h=[{id:0,hook:t,handler:e}],l)){const i=r.length-1,{handler:s,once:n}=r[i],o=t=>{const i=r[t-1];return i?(e,s)=>i.handler(e,s,o(t-1)):e};h=[{id:0,hook:t,once:n,handler:s,defaultHandler:o(i)}]}return{found:!0,before:o,handler:h,after:a,replaced:l}}sortRegistrations(t,e){var i,s;return(null!=(i=t.priority)?i:0)-(null!=(s=e.priority)?s:0)||t.id-e.id||0}dispatchDomEvent(t,e,i){if(null!=e&&e.done)return;const s={hook:t,args:i,visit:e||this.swup.visit};document.dispatchEvent(new CustomEvent(\"swup:any\",{detail:s,bubbles:!0})),document.dispatchEvent(new CustomEvent(`swup:${t}`,{detail:s,bubbles:!0}))}parseName(t){const[e,...s]=t.split(\".\");return[e,s.reduce((t,e)=>i({},t,{[e]:!0}),{})]}}const C=t=>{if(t&&\"#\"===t.charAt(0)&&(t=t.substring(1)),!t)return null;const e=decodeURIComponent(t);let i=document.getElementById(t)||document.getElementById(e)||p(`a[name='${CSS.escape(t)}']`)||p(`a[name='${CSS.escape(e)}']`);return i||\"top\"!==t||(i=document.body),i},U=\"transition\",P=\"animation\";async function $({selector:t,elements:e}){if(!1===t&&!e)return;let i=[];if(e)i=Array.from(e);else if(t&&(i=m(t,document.body),!i.length))return void console.warn(`[swup] No elements found matching animationSelector \\`${t}\\``);const s=i.map(t=>function(t){const{type:e,timeout:i,propCount:s}=function(t){const e=window.getComputedStyle(t),i=A(e,`${U}Delay`),s=A(e,`${U}Duration`),n=x(i,s),o=A(e,`${P}Delay`),r=A(e,`${P}Duration`),a=x(o,r),l=Math.max(n,a),h=l>0?n>a?U:P:null;return{type:h,timeout:l,propCount:h?h===U?s.length:r.length:0}}(t);return!(!e||!i)&&new Promise(n=>{const o=`${e}end`,r=performance.now();let a=0;const l=()=>{t.removeEventListener(o,h),n()},h=e=>{e.target===t&&((performance.now()-r)/1e3<e.elapsedTime||++a>=s&&l())};setTimeout(()=>{a<s&&l()},i+1),t.addEventListener(o,h)})}(t));s.filter(Boolean).length>0?await Promise.all(s):t&&console.warn(`[swup] No CSS animation duration defined on elements matching \\`${t}\\``)}function A(t,e){return(t[e]||\"\").split(\", \")}function x(t,e){for(;t.length<e.length;)t=t.concat(t);return Math.max(...e.map((e,i)=>H(e)+H(t[i])))}function H(t){return 1e3*parseFloat(t)}function V(t,e={},s={}){if(\"string\"!=typeof t)throw new Error(\"swup.navigate() requires a URL parameter\");if(this.shouldIgnoreVisit(t,{el:s.el,event:s.event}))return void window.location.assign(t);const{url:n,hash:o}=l.fromUrl(t),r=this.createVisit(i({},s,{to:n,hash:o}));this.performNavigation(r,e)}async function I(t,e={}){if(this.navigating){if(this.visit.state>=6)return t.state=2,void(this.onVisitEnd=()=>this.performNavigation(t,e));await this.hooks.call(\"visit:abort\",this.visit,void 0),delete this.visit.to.document,this.visit.state=8}this.navigating=!0,this.visit=t;const{el:i}=t.trigger;e.referrer=e.referrer||this.location.url,!1===e.animate&&(t.animation.animate=!1),t.animation.animate||this.classes.clear();const n=e.history||y(i,\"data-swup-history\");\"string\"==typeof n&&[\"push\",\"replace\"].includes(n)&&(t.history.action=n);const a=e.animation||y(i,\"data-swup-animation\");var h,c;\"string\"==typeof a&&(t.animation.name=a),t.meta=e.meta||{},\"object\"==typeof e.cache?(t.cache.read=null!=(h=e.cache.read)?h:t.cache.read,t.cache.write=null!=(c=e.cache.write)?c:t.cache.write):void 0!==e.cache&&(t.cache={read:!!e.cache,write:!!e.cache}),delete e.cache;try{await this.hooks.call(\"visit:start\",t,void 0),t.state=3;const i=this.hooks.call(\"page:load\",t,{options:e},async(t,e)=>{let i;return t.cache.read&&(i=this.cache.get(t.to.url)),e.page=i||await this.fetchPage(t.to.url,e.options),e.cache=!!i,e.page});i.then(({html:e})=>{t.advance(5),t.to.html=e,t.to.document=(new DOMParser).parseFromString(e,\"text/html\")});const n=t.to.url+t.to.hash;if(t.history.popstate||(\"replace\"===t.history.action||t.to.url===this.location.url?r(n):(this.currentHistoryIndex++,o(n,{index:this.currentHistoryIndex}))),this.location=l.fromUrl(n),t.history.popstate&&this.classes.add(\"is-popstate\"),t.animation.name&&this.classes.add(`to-${s(t.animation.name)}`),t.animation.wait&&await i,t.done)return;if(await this.hooks.call(\"visit:transition\",t,void 0,async()=>{if(!t.animation.animate)return await this.hooks.call(\"animation:skip\",void 0),void await this.renderPage(t,await i);t.advance(4),await this.animatePageOut(t),t.animation.native&&document.startViewTransition?await document.startViewTransition(async()=>await this.renderPage(t,await i)).finished:await this.renderPage(t,await i),await this.animatePageIn(t)}),t.done)return;await this.hooks.call(\"visit:end\",t,void 0,()=>this.classes.clear()),t.state=7,this.navigating=!1,this.onVisitEnd&&(this.onVisitEnd(),this.onVisitEnd=void 0)}catch(e){if(!e||null!=e&&e.aborted)return void(t.state=8);t.state=9,console.error(e),this.options.skipPopStateHandling=()=>(window.location.assign(t.to.url+t.to.hash),!0),window.history.back()}finally{delete t.to.document}}const L=async function(t){await this.hooks.call(\"animation:out:start\",t,void 0,()=>{this.classes.add(\"is-changing\",\"is-animating\",\"is-leaving\")}),await this.hooks.call(\"animation:out:await\",t,{skip:!1},(t,{skip:e})=>{if(!e)return this.awaitAnimations({selector:t.animation.selector})}),await this.hooks.call(\"animation:out:end\",t,void 0)},q=function(t){var e;const i=t.to.document;if(!i)return!1;const s=(null==(e=i.querySelector(\"title\"))?void 0:e.innerText)||\"\";document.title=s;const n=m('[data-swup-persist]:not([data-swup-persist=\"\"])'),o=t.containers.map(t=>{const e=document.querySelector(t),s=i.querySelector(t);return e&&s?(e.replaceWith(s.cloneNode(!0)),!0):(e||console.warn(`[swup] Container missing in current document: ${t}`),s||console.warn(`[swup] Container missing in incoming document: ${t}`),!1)}).filter(Boolean);return n.forEach(t=>{const e=t.getAttribute(\"data-swup-persist\"),i=p(`[data-swup-persist=\"${e}\"]`);i&&i!==t&&i.replaceWith(t)}),o.length===t.containers.length},R=function(t){const e={behavior:\"auto\"},{target:s,reset:n}=t.scroll,o=null!=s?s:t.to.hash;let r=!1;return o&&(r=this.hooks.callSync(\"scroll:anchor\",t,{hash:o,options:e},(t,{hash:e,options:i})=>{const s=this.getAnchorElement(e);return s&&s.scrollIntoView(i),!!s})),n&&!r&&(r=this.hooks.callSync(\"scroll:top\",t,{options:e},(t,{options:e})=>(window.scrollTo(i({top:0,left:0},e)),!0))),r},T=async function(t){if(t.done)return;const e=this.hooks.call(\"animation:in:await\",t,{skip:!1},(t,{skip:e})=>{if(!e)return this.awaitAnimations({selector:t.animation.selector})});await w(),await this.hooks.call(\"animation:in:start\",t,void 0,()=>{this.classes.remove(\"is-animating\")}),await e,await this.hooks.call(\"animation:in:end\",t,void 0)},N=async function(t,e){if(t.done)return;t.advance(6);const{url:i}=e;this.isSameResolvedUrl(n(),i)||(r(i),this.location=l.fromUrl(i),t.to.url=this.location.url,t.to.hash=this.location.hash),await this.hooks.call(\"content:replace\",t,{page:e},(t,{})=>{if(this.classes.remove(\"is-leaving\"),t.animation.animate&&this.classes.add(\"is-rendering\"),!this.replaceContent(t))throw new Error(\"[swup] Container mismatch, aborting\");t.animation.animate&&(this.classes.add(\"is-changing\",\"is-animating\",\"is-rendering\"),t.animation.name&&this.classes.add(`to-${s(t.animation.name)}`))}),await this.hooks.call(\"content:scroll\",t,void 0,()=>this.scrollToContent(t)),await this.hooks.call(\"page:view\",t,{url:this.location.url,title:document.title})},O=function(t){var e;if(e=t,Boolean(null==e?void 0:e.isSwupPlugin)){if(t.swup=this,!t._checkRequirements||t._checkRequirements())return t._beforeMount&&t._beforeMount(),t.mount(),this.plugins.push(t),this.plugins}else console.error(\"Not a swup plugin instance\",t)};function D(t){const e=this.findPlugin(t);if(e)return e.unmount(),e._afterUnmount&&e._afterUnmount(),this.plugins=this.plugins.filter(t=>t!==e),this.plugins;console.error(\"No such plugin\",e)}function M(t){return this.plugins.find(e=>e===t||e.name===t||e.name===`Swup${String(t)}`)}function W(t){if(\"function\"!=typeof this.options.resolveUrl)return console.warn(\"[swup] options.resolveUrl expects a callback function.\"),t;const e=this.options.resolveUrl(t);return e&&\"string\"==typeof e?e.startsWith(\"//\")||e.startsWith(\"http\")?(console.warn(\"[swup] options.resolveUrl needs to return a relative url\"),t):e:(console.warn(\"[swup] options.resolveUrl needs to return a url\"),t)}function B(t,e){return this.resolveUrl(t)===this.resolveUrl(e)}const j={animateHistoryBrowsing:!1,animationSelector:'[class*=\"transition-\"]',animationScope:\"html\",cache:!0,containers:[\"#swup\"],hooks:{},ignoreVisit:(t,{el:e}={})=>!(null==e||!e.closest(\"[data-no-swup]\")),linkSelector:\"a[href]\",linkToSelf:\"scroll\",native:!1,plugins:[],resolveUrl:t=>t,requestHeaders:{\"X-Requested-With\":\"swup\",Accept:\"text/html, application/xhtml+xml\"},skipPopStateHandling:t=>{var e;return\"swup\"!==(null==(e=t.state)?void 0:e.source)},timeout:0};class _{get currentPageUrl(){return this.location.url}constructor(t={}){var e,s;this.version=\"4.8.2\",this.options=void 0,this.defaults=j,this.plugins=[],this.visit=void 0,this.cache=void 0,this.hooks=void 0,this.classes=void 0,this.location=l.fromUrl(window.location.href),this.currentHistoryIndex=void 0,this.clickDelegate=void 0,this.navigating=!1,this.onVisitEnd=void 0,this.use=O,this.unuse=D,this.findPlugin=M,this.log=()=>{},this.navigate=V,this.performNavigation=I,this.createVisit=S,this.delegateEvent=a,this.fetchPage=u,this.awaitAnimations=$,this.renderPage=N,this.replaceContent=q,this.animatePageIn=T,this.animatePageOut=L,this.scrollToContent=R,this.getAnchorElement=C,this.getCurrentUrl=n,this.resolveUrl=W,this.isSameResolvedUrl=B,this.options=i({},this.defaults,t),this.handleLinkClick=this.handleLinkClick.bind(this),this.handlePopState=this.handlePopState.bind(this),this.cache=new d(this),this.classes=new k(this),this.hooks=new E(this),this.visit=this.createVisit({to:\"\"}),this.currentHistoryIndex=null!=(e=null==(s=window.history.state)?void 0:s.index)?e:1,this.enable()}async enable(){var t;const{linkSelector:e}=this.options;this.clickDelegate=this.delegateEvent(e,\"click\",this.handleLinkClick),window.addEventListener(\"popstate\",this.handlePopState),this.options.animateHistoryBrowsing&&(window.history.scrollRestoration=\"manual\"),this.options.native=this.options.native&&!!document.startViewTransition,this.options.plugins.forEach(t=>this.use(t));for(const[t,e]of Object.entries(this.options.hooks)){const[i,s]=this.hooks.parseName(t);this.hooks.on(i,e,s)}\"swup\"!==(null==(t=window.history.state)?void 0:t.source)&&r(null,{index:this.currentHistoryIndex}),await w(),await this.hooks.call(\"enable\",void 0,void 0,()=>{const t=document.documentElement;t.classList.add(\"swup-enabled\"),t.classList.toggle(\"swup-native\",this.options.native)})}async destroy(){this.clickDelegate.destroy(),window.removeEventListener(\"popstate\",this.handlePopState),this.cache.clear(),this.options.plugins.forEach(t=>this.unuse(t)),await this.hooks.call(\"disable\",void 0,void 0,()=>{const t=document.documentElement;t.classList.remove(\"swup-enabled\"),t.classList.remove(\"swup-native\")}),this.hooks.clear()}shouldIgnoreVisit(t,{el:e,event:i}={}){const{origin:s,url:n,hash:o}=l.fromUrl(t);return s!==window.location.origin||!(!e||!this.triggerWillOpenNewWindow(e))||!!this.options.ignoreVisit(n+o,{el:e,event:i})}handleLinkClick(t){const e=t.delegateTarget,{href:i,url:s,hash:n}=l.fromElement(e);if(this.shouldIgnoreVisit(i,{el:e,event:t}))return;if(this.navigating&&s===this.visit.to.url)return void t.preventDefault();const o=this.createVisit({to:s,hash:n,el:e,event:t});t.metaKey||t.ctrlKey||t.shiftKey||t.altKey?this.hooks.callSync(\"link:newtab\",o,{href:i}):0===t.button&&this.hooks.callSync(\"link:click\",o,{el:e,event:t},()=>{var e;const i=null!=(e=o.from.url)?e:\"\";t.preventDefault(),s&&s!==i?this.isSameResolvedUrl(s,i)||this.performNavigation(o):n?this.hooks.callSync(\"link:anchor\",o,{hash:n},()=>{r(s+n),this.scrollToContent(o)}):this.hooks.callSync(\"link:self\",o,void 0,()=>{\"navigate\"===this.options.linkToSelf?this.performNavigation(o):(r(s),this.scrollToContent(o))})})}handlePopState(t){var e,i,s,o;const r=null!=(e=null==(i=t.state)?void 0:i.url)?e:window.location.href;if(this.options.skipPopStateHandling(t))return;if(this.isSameResolvedUrl(n(),this.location.url))return;const{url:a,hash:h}=l.fromUrl(r),c=this.createVisit({to:a,hash:h,event:t});c.history.popstate=!0;const u=null!=(s=null==(o=t.state)?void 0:o.index)?s:0;u&&u!==this.currentHistoryIndex&&(c.history.direction=u-this.currentHistoryIndex>0?\"forwards\":\"backwards\",this.currentHistoryIndex=u),c.animation.animate=!1,c.scroll.reset=!1,c.scroll.target=!1,this.options.animateHistoryBrowsing&&(c.animation.animate=!0,c.scroll.reset=!0),this.hooks.callSync(\"history:popstate\",c,{event:t},()=>{this.performNavigation(c)})}triggerWillOpenNewWindow(t){return!!t.matches('[download], [target=\"_blank\"]')}}export{l as Location,s as classify,o as createHistoryRecord,_ as default,a as delegateEvent,v as forceReflow,y as getContextualAttr,n as getCurrentUrl,f as isPromise,h as matchPath,w as nextTick,p as query,m as queryAll,g as runAsPromise,r as updateHistoryRecord};\n//# sourceMappingURL=Swup.modern.js.map\n","import type { Handler } from 'swup';\nimport { highlight } from './Logger.js';\nimport type { default as FragmentPlugin } from '../SwupFragmentPlugin.js';\n\nimport {\n\thandlePageView,\n\tgetRoute,\n\ttoggleFragmentVisitClass,\n\tgetFirstMatchingRule,\n\tcacheForeignFragmentElements,\n\tshouldSkipAnimation,\n\tadjustVisitScroll\n} from './functions.js';\n\nimport { __DEV__ } from './env.js';\n\n/**\n * Do not scroll if clicking on a link to the same page\n * and the route matches a fragment rule\n */\nexport const onLinkToSelf: Handler<'link:self'> = function (this: FragmentPlugin, visit) {\n\tconst route = getRoute(visit);\n\tif (!route) return;\n\n\tconst rule = getFirstMatchingRule(route, this.parsedRules, visit);\n\n\tif (rule) visit.scroll.reset = false;\n};\n\n/**\n * Prepare fragment visits\n */\nexport const onVisitStart: Handler<'visit:start'> = async function (this: FragmentPlugin, visit) {\n\tconst route = getRoute(visit);\n\tif (!route) return;\n\n\tconst fragmentVisit = this.getFragmentVisit(route, visit);\n\n\t/**\n\t * Bail early if the current route doesn't match\n\t * a rule or wouldn't replace any fragment elements\n\t */\n\tif (!fragmentVisit) return;\n\n\tvisit.fragmentVisit = fragmentVisit;\n\n\tif (__DEV__) {\n\t\tthis.logger?.log(`fragment visit: ${highlight(visit.fragmentVisit.containers.join(', '))}`);\n\t}\n\n\tvisit.scroll = adjustVisitScroll(fragmentVisit, visit.scroll);\n\n\t// Fragment Plugin can't know if Accesssibilty Plugin is installed\n\t// @ts-expect-error\n\tconst a11y = visit.a11y as { focus?: boolean | string };\n\tif (typeof fragmentVisit.focus !== 'undefined') {\n\t\tif (__DEV__) {\n\t\t\tthis.logger?.errorIf(\n\t\t\t\t!a11y,\n\t\t\t\t\"Can't set visit.a11y.focus. Is @swup/a11y-plugin installed?\"\n\t\t\t);\n\t\t}\n\t\tif (a11y) a11y.focus = fragmentVisit.focus;\n\t}\n\n\t// Add the transition classes directly to the containers for this visit\n\tvisit.animation.scope = visit.fragmentVisit.containers;\n\n\t// Overwrite the containers for this visit\n\tvisit.containers = visit.fragmentVisit.containers;\n\n\t// Overwrite the animationSelector for this visit\n\tvisit.animation.selector = visit.fragmentVisit.containers.join(',');\n\n\ttoggleFragmentVisitClass(fragmentVisit, true);\n};\n\n/**\n * Skips the out-animation for <template> fragment elements\n */\nexport const maybeSkipOutAnimation: Handler<'animation:out:await'> = function (\n\tthis: FragmentPlugin,\n\tvisit,\n\targs\n) {\n\tif (visit.fragmentVisit && shouldSkipAnimation(visit.fragmentVisit)) {\n\t\tif (__DEV__)\n\t\t\tthis.logger?.log(\n\t\t\t\t`${highlight('out')}-animation skipped for ${highlight(\n\t\t\t\t\tvisit.fragmentVisit?.containers.toString()\n\t\t\t\t)}`\n\t\t\t);\n\t\targs.skip = true;\n\t}\n};\n\n/**\n * Skips the in-animation for <template> fragment elements\n */\nexport const maybeSkipInAnimation: Handler<'animation:in:await'> = function (\n\tthis: FragmentPlugin,\n\tvisit,\n\targs\n) {\n\tif (visit.fragmentVisit && shouldSkipAnimation(visit.fragmentVisit)) {\n\t\tif (__DEV__)\n\t\t\tthis.logger?.log(\n\t\t\t\t`${highlight('in')}-animation skipped for ${highlight(\n\t\t\t\t\tvisit.fragmentVisit?.containers.toString()\n\t\t\t\t)}`\n\t\t\t);\n\t\targs.skip = true;\n\t}\n};\n\n/**\n * Runs directly before replacing the content\n */\nexport const beforeContentReplace: Handler<'content:replace'> = function (\n\tthis: FragmentPlugin,\n\tvisit,\n\targs\n) {\n\t/**\n\t * Only use the fragment cache if navigating without a trigger (e.g. link click)\n\t * (PopStateEvent, swup.navigate)\n\t */\n\tif (visit.trigger.el || !visit.to.url) return;\n\n\tconst cache = this.swup.cache.get(visit.to.url);\n\tif (!cache || !cache.fragmentHtml) return;\n\n\tvisit.to.document = new DOMParser().parseFromString(cache.fragmentHtml, 'text/html');\n\tvisit.to.html = cache.fragmentHtml;\n\n\tif (__DEV__) this.logger?.log(`fragment cache used for ${highlight(visit.to.url!)}`);\n};\n\n/**\n * Runs after the content was replaced\n */\nexport const onContentReplace: Handler<'content:replace'> = function (this: FragmentPlugin, visit) {\n\ttoggleFragmentVisitClass(visit.fragmentVisit, true);\n\thandlePageView(this);\n\tcacheForeignFragmentElements(this);\n};\n\n/**\n * Remove possible fragment rule names from fragment elements\n */\nexport const onVisitEnd: Handler<'visit:end'> = function (this: FragmentPlugin, visit) {\n\ttoggleFragmentVisitClass(visit.fragmentVisit, false);\n};\n","import PluginBase from '@swup/plugin';\nimport ParsedRule from './inc/ParsedRule.js';\nimport Logger from './inc/Logger.js';\nimport {\n\thandlePageView,\n\tcleanupFragmentElements,\n\tgetFirstMatchingRule,\n\tgetFragmentVisitContainers,\n\tcloneRules\n} from './inc/functions.js';\nimport type { Options, Rule, Route, FragmentVisit } from './inc/defs.js';\nimport * as handlers from './inc/handlers.js';\nimport { __DEV__ } from './inc/env.js';\nimport type { Visit } from 'swup';\n\ntype RequireKeys<T, K extends keyof T> = Partial<T> & Pick<T, K>;\ntype InitOptions = RequireKeys<Options, 'rules'>;\n\n/**\n * The main plugin class\n */\nexport default class SwupFragmentPlugin extends PluginBase {\n\treadonly name = 'SwupFragmentPlugin';\n\treadonly requires = { swup: '>=4.6' };\n\n\tprotected _rawRules: Rule[] = [];\n\tprotected _parsedRules: ParsedRule[] = [];\n\n\tget parsedRules() {\n\t\treturn this._parsedRules;\n\t}\n\n\toptions: Options;\n\n\tprotected defaults: Options = {\n\t\trules: [],\n\t\tdebug: false\n\t};\n\n\tlogger?: Logger;\n\n\t/**\n\t * Plugin Constructor\n\t * The options are NOT optional and need to contain at least a `rules` property\n\t */\n\tconstructor(options: InitOptions) {\n\t\tsuper();\n\t\tthis.options = { ...this.defaults, ...options };\n\t}\n\n\t/**\n\t * Runs when the plugin is being mounted\n\t */\n\tmount() {\n\t\tconst swup = this.swup;\n\n\t\tthis.setRules(this.options.rules);\n\t\tif (__DEV__) {\n\t\t\tif (this.options.debug) this.logger = new Logger();\n\t\t}\n\n\t\tthis.before('link:self', handlers.onLinkToSelf);\n\t\tthis.on('visit:start', handlers.onVisitStart);\n\t\tthis.before('animation:out:await', handlers.maybeSkipOutAnimation);\n\t\tthis.before('animation:in:await', handlers.maybeSkipInAnimation);\n\t\tthis.before('content:replace', handlers.beforeContentReplace);\n\t\tthis.on('content:replace', handlers.onContentReplace);\n\t\tthis.on('visit:end', handlers.onVisitEnd);\n\n\t\tif (__DEV__) {\n\t\t\tthis.logger?.warnIf(\n\t\t\t\t!swup.options.cache,\n\t\t\t\t`fragment caching will only work with swup's cache being active`\n\t\t\t);\n\t\t}\n\n\t\thandlePageView(this);\n\t}\n\n\t/**\n\t * Runs when the plugin is being unmounted\n\t */\n\tunmount() {\n\t\tsuper.unmount();\n\t\tcleanupFragmentElements();\n\t}\n\n\t/**\n\t * Set completely new rules\n\t *\n\t * @access public\n\t */\n\tsetRules(rules: Rule[]) {\n\t\tthis._rawRules = cloneRules(rules);\n\t\tthis._parsedRules = rules.map((rule) => this.parseRule(rule));\n\t\tif (__DEV__) this.logger?.log('Updated fragment rules', this.getRules());\n\t}\n\n\t/**\n\t * Get a clone of the current rules\n\t *\n\t * @access public\n\t */\n\tgetRules() {\n\t\treturn cloneRules(this._rawRules);\n\t}\n\n\t/**\n\t * Prepend a rule to the existing rules\n\t *\n\t * @access public\n\t */\n\tprependRule(rule: Rule) {\n\t\tthis.setRules([rule, ...this.getRules()]);\n\t}\n\n\t/**\n\t * Append a rule to the existing rules\n\t *\n\t * @access public\n\t */\n\tappendRule(rule: Rule) {\n\t\tthis.setRules([...this.getRules(), rule]);\n\t}\n\n\t/**\n\t * Parse a rule (for e.g. debugging)\n\t *\n\t * @access public\n\t */\n\tparseRule(rule: Rule): ParsedRule {\n\t\treturn new ParsedRule({\n\t\t\t...rule,\n\t\t\tlogger: this.logger,\n\t\t\tswup: this.swup\n\t\t});\n\t}\n\n\t/**\n\t * Get the fragment visit object for a given route\n\t *\n\t * @access public\n\t */\n\tgetFragmentVisit(route: Route, visit?: Visit): FragmentVisit | undefined {\n\t\tconst rule = getFirstMatchingRule(\n\t\t\troute,\n\t\t\tthis.parsedRules,\n\t\t\t// @ts-expect-error createVisit is protected\n\t\t\tvisit || this.swup.createVisit(route)\n\t\t);\n\n\t\t// Bail early if no rule matched\n\t\tif (!rule) return;\n\n\t\t// Get containers that should be replaced for this visit\n\t\tconst containers = getFragmentVisitContainers(\n\t\t\troute,\n\t\t\trule.containers,\n\t\t\tthis.swup,\n\t\t\tthis.logger\n\t\t);\n\n\t\t/** Bail early if there are no fragment elements found for this visit */\n\t\tif (!containers.length) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Pick properties from the current rule that should be projected into the fragmentVisit object\n\t\tconst { name, scroll, focus } = rule;\n\n\t\tconst fragmentVisit: FragmentVisit = {\n\t\t\tcontainers,\n\t\t\tname,\n\t\t\tscroll,\n\t\t\tfocus\n\t\t};\n\n\t\treturn fragmentVisit;\n\t}\n}\n"],"names":["n","r","String","split","map","parseInt","concat","slice","join","e","every","t","s","match","o","i","localeCompare","numeric","str","options","keys","re","_a","decode","x","pathname","m","exec","path","index","params","Object","create","undefined","key","name","modifier","prefix","suffix","value","length","regexpToFunction","pathToRegexp","escapeString","replace","flags","sensitive","RegExp","groupsRegex","execResult","source","push","pattern","regexpToRegexp","Array","isArray","paths","parts","arrayToRegexp","tokens","strict","_b","start","_c","end","_d","encode","_e","delimiter","_f","endsWith","endsWithRe","delimiterRe","route","_i","tokens_1","token","mod","TypeError","endToken","isEndDelimited","indexOf","tokensToRegexp","char","type","count","j","code","charCodeAt","lexer","prefixes","result","tryConsume","mustConsume","consumeText","safePattern","prev","prevText","delimiter_1","isSafe","name_1","pattern_1","parse","stringToRegexp","window","process","env","__TEST__","includes","__DEV__","wrapInEscapeSequence","open","close","prepare","bold","highlight","purple","Logger","log","args","call","arguments","msg","shift","console","warn","error","logIf","condition","this","warnIf","errorIf","handlePageView","fragmentPlugin","parsedRules","swup","logger","currentUrl","getCurrentUrl","filter","rule","matchesFrom","matchesTo","forEach","containers","selector","el","queryFragmentElement","providedFragmentUrl","getAttribute","url","Location","fromUrl","setAttribute","__swupFragment","prepareFragmentElements","targetAttribute","document","querySelectorAll","fragment","fragmentUrl","isEqualUrl","href","handleLinksToFragments","modalShown","removeAttribute","showModal","addEventListener","preventDefault","showDialogs","elementMatchesFragmentUrl","url1","url2","normalizeUrl","trim","location","searchParams","sort","search","getRoute","visit","from","to","toggleFragmentVisitClass","fragmentVisit","toggle","querySelector","classList","getFirstMatchingRule","rules","find","matches","shouldSkipAnimation","tagName","toLowerCase","fragmentSelector","containerSelector","container","cloneRules","Error","ParsedRule","constructor","scroll","focus","if","parseContainers","matchPath","rawContainers","arr","Set","validateSelector","getDebugInfo","startsWith","toUrl","validateFragmentSelectorForMatch","onLinkToSelf","reset","onVisitStart","_this","Promise","resolve","getFragmentVisit","target","adjustVisitScroll","a11y","animation","scope","reject","maybeSkipOutAnimation","toString","skip","maybeSkipInAnimation","beforeContentReplace","trigger","cache","get","fragmentHtml","DOMParser","parseFromString","html","onContentReplace","cacheForeignFragmentElements","currentCache","currentCachedDocument","updatedFragments","foreignFragmentElements","fragmentCache","currentFragment","unchangedFragment","replaceWith","update","documentElement","outerHTML","onVisitEnd","PluginBase","_parsedRules","super","requires","_rawRules","defaults","debug","mount","setRules","before","handlers","on","unmount","parseRule","getRules","prependRule","appendRule","createVisit","getFragmentVisitContainers","selectors","fragments","record","isLinkToSelf","linkToSelf"],"mappings":"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"}